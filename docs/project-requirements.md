# NotifyHub 项目需求文档 (v1.1)

## 1. 项目背景与目标

### 1.1. 背景
在现代应用开发中，向用户或系统发送通知是一个普遍需求。这些通知可能通过多种渠道，如电子邮件、企业即时通讯工具（飞书、钉钉）、短信等。开发者在集成这些渠道时，往往面临接口不一、逻辑分散、缺乏统一监控和管理等痛点。

### 1.2. 目标
NotifyHub 旨在解决以上问题，其核心目标是：
*   **统一接口**: 提供一个统一、简洁的 API，用于向所有支持的渠道发送通知。
*   **提升效率**: 让开发者从繁琐的各渠道 SDK 集成工作中解放出来。
*   **保障可靠性**: 提供异步处理、失败重试、状态回调等机制。
*   **易于扩展**: 提供一个开放的、插件化的架构，允许开发者轻松集成新的通知渠道。

---

## 2. 功能性需求 (Functional Requirements)

| ID | 需求描述 | 优先级 |
| :--- | :--- | :--- |
| **FR1** | **统一发送接口** | 高 |
| | 系统必须提供一个统一的 API，用于屏蔽底层不同渠道的实现差异。 | |
| **FR2** | **多渠道支持** | 高 |
| | 系统应内置支持多种主流通知渠道，如 Email、飞书等。 | |
| **FR3** | **可扩展的渠道** | 高 |
| | 必须提供插件化的架构，允许开发者通过实现标准接口，轻松集成新的通知渠道。 | |
| **FR4** | **双发送模式** | 高 |
| | 必须同时支持 **同步发送** 和 **异步发送** 两种模式。 | |
| **FR5** | **消息模板** | 高 |
| | 必须支持使用模板来渲染消息内容。 | |
| **FR6** | **动态模板源** | 中 |
| | 必须支持从不同的来源（如文件、远程API）加载模板。 | |
| **FR7** | **异步重试** | 高 |
| | 对于异步发送失败的消息，必须提供自动重试机制和可配置的策略。 | |
| **FR8** | **失败处理机制** | 高 |
| | 必须为异步发送提供单消息完成回调和全局失败处理器。 | |
| **FR9** | **消息路由** | 高 |
| | 系统必须支持根据消息的 `Channel` 字段，将其路由到正确的通知渠道。 | |
| **FR10** | **批量发送** | 高 |
| | 系统应提供一个批量发送的 API（`SendBatch`）以提升性能。 | |
| **FR11** | **消息优先级** | 中 |
| | 队列系统应能优先处理高优先级的消息。 | |
| **FR12** | **延迟/计划消息** | 中 |
| | 提供发送延迟消息的能力。 | |
| **FR13** | **可插拔日志系统** | 高 |
| | 系统必须提供一个标准的日志接口，并允许用户对接到 `zap`, `logrus` 等主流日志库。 | |

---

## 3. 非功能性需求 (Non-Functional Requirements)

| ID | 需求类型 | 需求描述 |
| :--- | :--- | :--- |
| **NFR1** | **性能** | 异步 `Send()` 接口的 P99 响应时间应在 10ms 以内。 | 
| **NFR2** | **可靠性** | 异步发送的消息应保证“至少一次”的投递语义。 | |
| **NFR3** | **易用性** | API 设计应简洁直观，并提供清晰的文档和示例。 | |
| **NFR4** | **可扩展性** | 核心模块（队列、通知器、模板加载器）必须是可插拔的。 | |
| **NFR5** | **可观测性** | 系统必须暴露关键指标、结构化日志，并支持分布式追踪。 | |
| **NFR6** | **安全性** | 所有敏感配置（如 API Key）必须被安全地管理，严禁出现在日志或源码中。 | |
| **NFR7** | **速率限制** | 应支持对单个 `Notifier` 的发送速率进行限制。 | |