# é£ä¹¦@äººåŠŸèƒ½ä½¿ç”¨æŒ‡å—

æœ¬æ–‡æ¡£ä»‹ç»äº†NotifyHubä¸­æ–°å¢çš„é£ä¹¦@äººåŠŸèƒ½ï¼ŒåŒ…æ‹¬ä½¿ç”¨æ–¹æ³•å’Œå®ç”¨ç¤ºä¾‹ã€‚

## åŠŸèƒ½æ¦‚è§ˆ

NotifyHubç°åœ¨å®Œå…¨æ”¯æŒé£ä¹¦çš„@äººåŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼š

- âœ… **@å•ä¸ªç”¨æˆ·** - æ”¯æŒæ–‡æœ¬ã€å¯Œæ–‡æœ¬å’Œå¡ç‰‡æ¶ˆæ¯
- âœ… **@å¤šä¸ªç”¨æˆ·** - ä¸€æ¬¡@å¤šä¸ªç”¨æˆ·ID
- âœ… **@æ‰€æœ‰äºº** - å‘é€@allé€šçŸ¥
- âœ… **è‡ªå®šä¹‰æ˜¾ç¤ºåç§°** - å¯ä»¥è®¾ç½®@äººæ—¶æ˜¾ç¤ºçš„ç”¨æˆ·å
- âœ… **å¤šç§æ¶ˆæ¯æ ¼å¼æ”¯æŒ** - æ–‡æœ¬ã€å¯Œæ–‡æœ¬ã€å¡ç‰‡æ¶ˆæ¯å‡æ”¯æŒ@äºº

## å¿«é€Ÿå¼€å§‹

### 1. @å•ä¸ªç”¨æˆ·

```go
message := client.NewMessage().
    Title("ğŸ“¢ é‡è¦é€šçŸ¥").
    Body("ç³»ç»Ÿå°†äºä»Šæ™š22:00è¿›è¡Œç»´æŠ¤ï¼Œé¢„è®¡è€—æ—¶30åˆ†é’Ÿã€‚").
    AtUser("ou_123456789", "å¼ ä¸‰").  // ç”¨æˆ·IDå’Œæ˜¾ç¤ºåç§°
    Priority(4).
    FeishuGroup("default").
    Build()

results, err := hub.Send(ctx, message, nil)
```

### 2. @å¤šä¸ªç”¨æˆ·

```go
message := client.NewMessage().
    Title("ğŸš¨ ç´§æ€¥äº‹ä»¶").
    Body("ç”Ÿäº§ç¯å¢ƒå‡ºç°å¼‚å¸¸ï¼Œè¯·ç›¸å…³äººå‘˜ç«‹å³å¤„ç†ï¼").
    AtUsers("ou_111111111", "ou_222222222", "ou_333333333").
    Priority(5).
    FeishuGroup("default").
    Build()
```

### 3. @æ‰€æœ‰äºº

```go
message := client.NewCard("ğŸ‰ å‘ç‰ˆé€šçŸ¥", "æ–°ç‰ˆæœ¬v2.1.0å·²æˆåŠŸå‘å¸ƒï¼").
    AtAll().
    Priority(3).
    FeishuGroup("default").
    Build()
```

### 4. å¡ç‰‡æ¶ˆæ¯@äºº

```go
cardMessage := client.NewCard("ğŸ“‹ ä»»åŠ¡åˆ†é…", "è¯·åŠæ—¶å¤„ç†").
    Metadata("ä¼˜å…ˆçº§", "é«˜").
    Metadata("æˆªæ­¢æ—¶é—´", "2024-12-31").
    AtUser("ou_444444444", "æå››").
    Priority(4).
    FeishuGroup("default").
    Build()
```

## APIå‚è€ƒ

### MessageBuilderæ–°å¢æ–¹æ³•

#### AtUser(userID string, userName ...string)
@æŒ‡å®šç”¨æˆ·
- `userID`: ç”¨æˆ·çš„é£ä¹¦IDï¼ˆå¿…å¡«ï¼‰
- `userName`: æ˜¾ç¤ºåç§°ï¼ˆå¯é€‰ï¼Œå¦‚æœä¸æä¾›åˆ™æ˜¾ç¤ºä¸º"ç”¨æˆ·"ï¼‰

```go
builder.AtUser("ou_123456789")                // åªæŒ‡å®šç”¨æˆ·ID
builder.AtUser("ou_123456789", "å¼ ä¸‰")        // æŒ‡å®šç”¨æˆ·IDå’Œæ˜¾ç¤ºåç§°
```

#### AtUsers(userIDs ...string)
@å¤šä¸ªç”¨æˆ·ï¼ˆåªä¼ ç”¨æˆ·IDï¼‰

```go
builder.AtUsers("ou_111111111", "ou_222222222", "ou_333333333")
```

#### AtAll()
@æ‰€æœ‰äºº

```go
builder.AtAll()
```

#### AtMentions(mentions []notifiers.AtMention)
ç›´æ¥è®¾ç½®@äººåˆ—è¡¨

```go
mentions := []notifiers.AtMention{
    {UserID: "ou_123456789", UserName: "å¼ ä¸‰", IsAll: false},
    {UserID: "all", IsAll: true},
}
builder.AtMentions(mentions)
```

#### ClearAtMentions()
æ¸…é™¤æ‰€æœ‰@äººè®¾ç½®

```go
builder.ClearAtMentions()
```

### AtMentionç»“æ„ä½“

```go
type AtMention struct {
    UserID   string `json:"user_id"`   // ç”¨æˆ·IDï¼Œ@æ‰€æœ‰äººæ—¶ä¸º"all"
    UserName string `json:"user_name"` // ç”¨æˆ·æ˜¾ç¤ºåç§°ï¼ˆå¯é€‰ï¼‰
    IsAll    bool   `json:"is_all"`    // æ˜¯å¦@æ‰€æœ‰äºº
}
```

## æ¶ˆæ¯æ ¼å¼æ”¯æŒ

### æ–‡æœ¬æ¶ˆæ¯ï¼ˆFormatTextï¼‰
@äººä¼šæ·»åŠ åˆ°æ¶ˆæ¯å†…å®¹çš„å¼€å¤´ï¼š
```
<at user_id="ou_123456789">å¼ ä¸‰</at> æ‚¨å¥½ï¼Œè¿™æ˜¯ä¸€æ¡é€šçŸ¥æ¶ˆæ¯ã€‚
```

### å¯Œæ–‡æœ¬æ¶ˆæ¯ï¼ˆFormatMarkdownï¼‰
@äººä¼šä½œä¸ºå¯Œæ–‡æœ¬å…ƒç´ æ’å…¥åˆ°ç¬¬ä¸€è¡Œï¼š
```json
{
  "msg_type": "post",
  "content": {
    "post": {
      "zh_cn": {
        "content": [
          [
            {"tag": "at", "user_id": "ou_123456789"},
            {"tag": "text", "text": " "},
            {"tag": "text", "text": "åŸæ¶ˆæ¯å†…å®¹..."}
          ]
        ]
      }
    }
  }
}
```

### å¡ç‰‡æ¶ˆæ¯ï¼ˆFormatCardï¼‰
@äººä¼šä½œä¸ºç‹¬ç«‹çš„divå…ƒç´ æ’å…¥åˆ°å¡ç‰‡çš„ç¬¬ä¸€ä¸ªä½ç½®ï¼š
```json
{
  "msg_type": "interactive",
  "card": {
    "elements": [
      {
        "tag": "div",
        "text": {
          "content": "<at user_id=\"ou_123456789\">å¼ ä¸‰</at>",
          "tag": "lark_md"
        }
      },
      // åŸæœ‰å¡ç‰‡å…ƒç´ ...
    ]
  }
}
```

## ç”¨æˆ·IDè·å–æ–¹æ³•

### æ–¹æ³•1: é€šè¿‡é£ä¹¦ç®¡ç†åå°
1. ç™»å½•é£ä¹¦ç®¡ç†åå°
2. è¿›å…¥ã€Œé€šè®¯å½•ã€
3. ç‚¹å‡»ç”¨æˆ·åç§°
4. åœ¨URLä¸­æ‰¾åˆ°ç”¨æˆ·IDï¼ˆou_å¼€å¤´ï¼‰

### æ–¹æ³•2: é€šè¿‡APIæŸ¥è¯¢
```bash
curl -X GET \
  'https://open.feishu.cn/open-apis/contact/v3/users' \
  -H 'Authorization: Bearer <access_token>'
```

### æ–¹æ³•3: åœ¨ç¾¤èŠä¸­@ç”¨æˆ·
1. åœ¨ç¾¤èŠä¸­@ç”¨æˆ·
2. æŸ¥çœ‹æ¶ˆæ¯çš„JSONæ ¼å¼
3. æå–user_idå­—æ®µ

## æœ€ä½³å®è·µ

### 1. åˆç†ä½¿ç”¨@äººåŠŸèƒ½
- **é‡è¦é€šçŸ¥**: ä½¿ç”¨@æ‰€æœ‰äºº
- **ä»»åŠ¡åˆ†é…**: @ç›¸å…³è´Ÿè´£äºº
- **ç´§æ€¥äº‹ä»¶**: @å¤šä¸ªå…³é”®äººå‘˜
- **æ—¥å¸¸æé†’**: @å•ä¸ªç”¨æˆ·

### 2. é¿å…è¿‡åº¦@äºº
- é¿å…é¢‘ç¹@æ‰€æœ‰äººï¼Œå½±å“ç”¨æˆ·ä½“éªŒ
- æ ¹æ®æ¶ˆæ¯é‡è¦æ€§é€‰æ‹©@äººèŒƒå›´
- åœ¨éå·¥ä½œæ—¶é—´è°¨æ…ä½¿ç”¨@åŠŸèƒ½

### 3. ç”¨æˆ·IDç®¡ç†
- å»ºç«‹ç”¨æˆ·IDæ˜ å°„è¡¨
- å®šæœŸæ›´æ–°ç”¨æˆ·ä¿¡æ¯
- å¤„ç†ç”¨æˆ·ç¦»èŒç­‰æƒ…å†µ

### 4. é”™è¯¯å¤„ç†
```go
message := client.NewMessage().
    Title("é€šçŸ¥").
    Body("å†…å®¹").
    AtUser("invalid_user_id").  // æ— æ•ˆçš„ç”¨æˆ·ID
    FeishuGroup("default").
    Build()

results, err := hub.Send(ctx, message, nil)
if err != nil {
    log.Printf("å‘é€å¤±è´¥: %v", err)
}

// æ£€æŸ¥å‘é€ç»“æœ
for _, result := range results {
    if !result.Success {
        log.Printf("@äººæ¶ˆæ¯å‘é€å¤±è´¥: %s", result.Error)
    }
}
```

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **@äººä¸ç”Ÿæ•ˆ**
   - æ£€æŸ¥ç”¨æˆ·IDæ ¼å¼æ˜¯å¦æ­£ç¡®ï¼ˆåº”ä»¥ou_å¼€å¤´ï¼‰
   - ç¡®è®¤ç”¨æˆ·åœ¨ç›®æ ‡ç¾¤ç»„ä¸­
   - éªŒè¯æœºå™¨äººæƒé™

2. **æ¶ˆæ¯æ ¼å¼å¼‚å¸¸**
   - æ£€æŸ¥@äººæ ‡ç­¾æ ¼å¼
   - éªŒè¯JSONç»“æ„
   - ç¡®è®¤å¹³å°æ”¯æŒ@äººåŠŸèƒ½

3. **ç”¨æˆ·æ”¶ä¸åˆ°é€šçŸ¥**
   - æ£€æŸ¥ç”¨æˆ·é€šçŸ¥è®¾ç½®
   - ç¡®è®¤ç”¨æˆ·çŠ¶æ€ï¼ˆåœ¨çº¿/ç¦»çº¿ï¼‰
   - éªŒè¯ç¾¤ç»„æƒé™

### è°ƒè¯•æŠ€å·§

```go
// å¯ç”¨è°ƒè¯•æ¨¡å¼æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
message := client.NewMessage().
    Title("è°ƒè¯•æµ‹è¯•").
    Body("æµ‹è¯•å†…å®¹").
    AtUser("ou_123456789", "æµ‹è¯•ç”¨æˆ·").
    Debug().  // å¯ç”¨è°ƒè¯•è¾“å‡º
    FeishuGroup("default").
    Build()
```

## ç¤ºä¾‹ä»£ç 

å®Œæ•´çš„@äººåŠŸèƒ½ç¤ºä¾‹ä»£ç ä½äºï¼š
- `examples/feishu/advanced/card-demo/main.go` - testAtMentionFeatureså‡½æ•°

è¿è¡Œç¤ºä¾‹ï¼š
```bash
cd examples/feishu/advanced/card-demo
go run main.go
```

## ç›¸å…³æ–‡æ¡£

- [å¡ç‰‡åŠŸèƒ½è¯¦ç»†æ–‡æ¡£](CARD_FEATURES.md)
- [NotifyHubåŸºç¡€ä½¿ç”¨](../basic/)
- [é£ä¹¦å¼€æ”¾å¹³å°æ–‡æ¡£](https://open.feishu.cn/document/)