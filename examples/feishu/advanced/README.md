# NotifyHub 飞书高级功能示例

这个目录包含了NotifyHub飞书功能的高级使用示例，包括模板、路由、重试、回调、延迟发送和批量发送等功能。

## 目录结构

```
advanced/
├── main.go              # 主程序 - 包含所有高级功能演示
├── card-demo/           # 卡片功能专项测试
│   ├── main.go         # 卡片功能独立测试程序
│   └── go.mod          # 独立模块配置
├── CARD_FEATURES.md     # 卡片功能详细文档
├── go.mod               # 主程序模块配置
└── README.md            # 本文件
```

## 功能概览

### 主程序 (main.go)
包含以下高级功能演示：

1. **📋 模板消息** - 自定义消息模板和变量替换
2. **🔀 消息路由** - 基于优先级的智能路由
3. **🔄 重试机制** - 失败重试和错误处理
4. **📞 回调监控** - 消息发送状态回调
5. **⏰ 延迟发送** - 定时和延迟消息发送
6. **📦 批量发送** - 高效的批量消息处理
7. **🎴 高级卡片** - 5种不同类型的交互式卡片

### 卡片专项测试 (card-demo/)
专门用于测试卡片功能的独立程序，包含：

1. **简单卡片** - 基于默认模板的卡片
2. **自定义卡片** - 完全自定义的卡片结构
3. **业务卡片** - 实际业务场景的卡片示例

## 快速开始

### 环境配置
确保设置了以下环境变量：
```bash
export NOTIFYHUB_FEISHU_WEBHOOK_URL="your-webhook-url"
export NOTIFYHUB_FEISHU_SECRET="your-webhook-secret"
```

### 运行主程序
```bash
cd examples/feishu/advanced
go run main.go
```

### 运行卡片测试
```bash
cd examples/feishu/advanced/card-demo
go run main.go
```

## 主要特性

### 1. 模板系统
- 支持自定义消息模板
- 变量替换和条件渲染
- 模板元数据管理

### 2. 智能路由
- 基于优先级的自动路由
- 多目标消息分发
- 路由规则配置

### 3. 可靠性保障
- 自动重试机制
- 指数退避策略
- 错误恢复处理

### 4. 异步处理
- 消息队列管理
- 异步发送支持
- 批量处理优化

### 5. 卡片功能
- 交互式卡片支持
- 多种卡片模板
- 自定义卡片元素

## 卡片类型说明

### 监控仪表板卡片
展示系统状态和性能指标，适用于：
- 服务器监控通知
- 性能警报
- 健康检查报告

### 事件处理卡片
用于紧急事件和故障处理，包含：
- 事件信息展示
- 处理操作按钮
- 状态跟踪链接

### 审批流程卡片
支持各种审批场景：
- 部署申请
- 权限申请
- 流程审批

### 动态数据卡片
实时数据展示：
- 实时性能数据
- 动态状态更新
- 时间戳标记

### 交互式卡片
复杂交互功能：
- 多按钮操作
- 媒体元素展示
- 用户引导提示

## 最佳实践

1. **合理使用优先级** - 根据消息重要性设置优先级
2. **避免频繁发送** - 注意API限流，适当添加延迟
3. **错误处理** - 始终检查发送结果和错误信息
4. **模板复用** - 对相似消息使用模板提高效率
5. **卡片设计** - 保持卡片内容简洁，按钮数量适中

## 故障排除

### 常见问题
- **API限流**: 错误码9499，减少发送频率
- **签名验证失败**: 检查webhook配置和密钥
- **卡片显示异常**: 验证JSON结构和飞书规范

### 性能优化
- 使用批量发送减少API调用
- 合理设置队列大小和工作协程数
- 启用重试机制提高成功率

## 相关文档

- [卡片功能详细文档](CARD_FEATURES.md)
- [NotifyHub基础使用](../basic/)
- [API参考文档](../../../README.md)

## 技术支持

如果遇到问题，请查看：
1. 控制台输出的详细错误信息
2. 飞书webhook配置是否正确
3. 网络连接和API限制情况